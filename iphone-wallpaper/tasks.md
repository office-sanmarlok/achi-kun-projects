# iPhone壁紙作成ツール - 実装タスクリスト

## Phase 1: 基盤構築とコアシステム

- [ ] 1. プロジェクトの初期セットアップとコア構造の構築
  - [ ] 1.1 プロジェクトのディレクトリ構造を作成
    - frontend/、backend/、shared/ディレクトリの作成
    - 各ディレクトリ内のサブフォルダ構成（components/, services/, utils/など）
  - [ ] 1.2 TypeScriptの設定とベースインターフェースの定義
    - tsconfig.jsonの設定
    - 共通型定義（Resolution, DeviceInfo, ImageData等）の作成
    - エラータイプの定義
    - _Requirements: 1.1, 1.3_
  - [ ] 1.3 基本的なテスト環境のセットアップ
    - Jestの設定とテストヘルパーの作成
    - テストデータとモックの準備
    - CI/CDパイプラインの基本設定

- [ ] 2. デバイス検出とモデル仕様管理の実装
  - [ ] 2.1 デバイスデータベースの作成と初期データ投入
    - iPhoneモデルの仕様データ（解像度、ノッチ情報等）の定義
    - デバイス仕様のJSONスキーマ作成
    - _Requirements: 1.1, 1.3_
  - [ ] 2.2 DeviceControllerクラスの実装とテスト
    - User-Agentパーサーの実装
    - デバイス検出ロジックの実装
    - フォールバック機能の実装
    - 単体テストの作成
    - _Requirements: 1.1, 1.2, 1.4_
  - [ ] 2.3 デバイス固有の調整機能の実装
    - ノッチ/ダイナミックアイランド回避ロジック
    - セーフエリア計算機能
    - デバイス向き対応機能
    - _Requirements: 1.4, 1.5_

## Phase 2: 画像処理とテンプレートシステム

- [ ] 3. 画像処理エンジンの基本実装
  - [ ] 3.1 ImageProcessorクラスの基本機能実装
    - 画像読み込み機能（File API対応）
    - 基本的なリサイズ・クロップ機能
    - 画像フォーマット変換機能
    - _Requirements: 3.1, 3.2_
  - [ ] 3.2 Canvas/WebGL処理レイヤーの実装
    - Canvasコンテキスト管理
    - WebGLシェーダーの基本実装
    - パフォーマンス最適化
    - _Requirements: 7.2_
  - [ ] 3.3 画像編集機能の実装とテスト
    - 色調整機能（明度、コントラスト、彩度、露出）
    - フィルター適用システム（15種類以上）
    - ぼかし効果（ガウシアン、モーション、被写界深度）
    - グラデーションオーバーレイ機能
    - 各機能の単体テスト
    - _Requirements: 3.3, 3.4, 3.5, 3.6_

- [ ] 4. テンプレートシステムの構築
  - [ ] 4.1 TemplateManagerクラスの実装
    - テンプレートデータ構造の定義
    - テンプレート読み込み・保存機能
    - カテゴリ管理機能
    - _Requirements: 2.1_
  - [ ] 4.2 テンプレートカスタマイズエンジンの実装
    - レイヤー管理システム
    - カラーカスタマイズ機能
    - テキスト編集機能（フォント、サイズ、配置）
    - リアルタイムプレビュー更新機能
    - _Requirements: 2.2, 2.3, 2.4, 2.5_
  - [ ] 4.3 初期テンプレートセットの作成
    - 最低20種類のテンプレートデザイン
    - カテゴリ分類（ミニマル、自然、幾何学模様等）
    - カスタマイズ可能要素の定義
    - _Requirements: 2.1, 2.6_

## Phase 3: AI統合とバックエンドサービス

- [ ] 5. AI画像生成機能の実装
  - [ ] 5.1 AIImageGeneratorサービスの基本実装
    - AI APIクライアントの実装（Stable Diffusion/DALL-E）
    - プロンプト検証機能（10-500文字）
    - キュー管理システム
    - _Requirements: 4.1, 4.2_
  - [ ] 5.2 生成プロセス管理機能の実装
    - 非同期ジョブ処理
    - 進行状況トラッキング
    - エラーハンドリングと再試行ロジック
    - _Requirements: 4.3, 4.4_
  - [ ] 5.3 バリエーション生成と後処理機能
    - 複数バリエーション生成（最低3つ）
    - 生成画像の後処理パイプライン
    - スタイルプリセット適用機能
    - _Requirements: 4.5, 4.6, 4.7_

- [ ] 6. バックエンドAPIとデータストレージ層の構築
  - [ ] 6.1 RESTful APIエンドポイントの実装
    - Express.jsセットアップとルーティング
    - 認証ミドルウェア（JWT）
    - エラーハンドリングミドルウェア
    - APIドキュメント生成
    - _Requirements: 8.5_
  - [ ] 6.2 データベース層の実装
    - PostgreSQLスキーマ作成とマイグレーション
    - リポジトリパターンの実装
    - データアクセス層のテスト
    - _Requirements: 6.2, 8.3_
  - [ ] 6.3 ファイルストレージサービスの実装
    - S3/Cloudinary統合
    - 画像アップロード処理
    - CDN配信設定
    - _Requirements: 8.3_

## Phase 4: ユーザーインターフェースと体験

- [ ] 7. UIコンポーネントとルーティングの実装
  - [ ] 7.1 React/Next.jsアプリケーションの基本構築
    - プロジェクト構造のセットアップ
    - ルーティング設定
    - 状態管理（Redux/Zustand）の設定
    - _Requirements: 7.5_
  - [ ] 7.2 メインエディターインターフェースの実装
    - デバイス選択UI
    - 作成モード選択（テンプレート/写真/AI）
    - エディターワークスペース
    - ツールパネルとコントロール
    - _Requirements: 1.2, 2.1, 3.1, 4.1_
  - [ ] 7.3 プレビューとダウンロード機能の実装
    - デバイスモックアップ表示
    - ホーム画面/ロック画面切り替え
    - ダウンロード処理（PNG/JPEG）
    - ファイル命名規則の実装
    - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 8. 認証とユーザー管理システムの構築
  - [ ] 8.1 認証フローの実装
    - メール/パスワード認証
    - ソーシャルログイン（Google、Apple ID）
    - JWT トークン管理
    - セッション管理
    - _Requirements: 6.1, 8.5_
  - [ ] 8.2 ユーザープロファイルとギャラリー機能
    - ユーザープロファイル管理
    - 作品ギャラリーUI
    - 作品の保存/編集/削除機能
    - 共有機能とリンク生成
    - _Requirements: 6.2, 6.3, 6.4, 6.5_
  - [ ] 8.3 プラン管理と制限機能
    - 無料/プレミアムプラン判定
    - 保存枚数制限（無料: 10枚）
    - アップグレード促進UI
    - _Requirements: 6.6_

## Phase 5: 最適化とセキュリティ

- [ ] 9. パフォーマンス最適化
  - [ ] 9.1 フロントエンド最適化
    - 初期ロード時間の最適化（3秒以内）
    - リアルタイムプレビュー最適化（100ms以内）
    - 画像処理のWorker実装
    - _Requirements: 7.1, 7.2_
  - [ ] 9.2 PWA機能の実装
    - Service Worker実装
    - オフライン対応
    - インストール可能な設定
    - 自動保存機能
    - _Requirements: 7.6_

- [ ] 10. セキュリティ実装
  - [ ] 10.1 コンテンツ検証とセキュリティ
    - アップロード画像のウイルススキャン
    - 不適切コンテンツ検出
    - CSRFトークン実装
    - _Requirements: 8.1, 8.2_
  - [ ] 10.2 データ保護とプライバシー
    - AES-256暗号化実装
    - HTTPS通信の確保
    - APIキー管理システム
    - データ削除フロー（30日）
    - _Requirements: 8.3, 8.4, 8.5, 8.6_

## Phase 6: 統合とテスト

- [ ] 11. 統合テストとエンドツーエンドテスト
  - [ ] 11.1 統合テストスイートの作成
    - API統合テスト
    - データフロー検証テスト
    - 認証・認可フローテスト
  - [ ] 11.2 E2Eテストの実装
    - Playwrightによる主要ユーザージャーニーテスト
    - 各作成モード（テンプレート/写真/AI）の完全フローテスト
    - クロスブラウザテスト
  - [ ] 11.3 パフォーマンステストとセキュリティ監査
    - 負荷テストの実施
    - セキュリティペネトレーションテスト
    - アクセシビリティ監査

- [ ] 12. 最終統合と品質保証
  - [ ] 12.1 全コンポーネントの統合
    - フロントエンド・バックエンド統合
    - 外部サービスとの接続確認
    - エラーハンドリングの総合テスト
  - [ ] 12.2 ユーザビリティテストと改善
    - UIフィードバックメカニズムの実装
    - エラーメッセージの改善
    - ヘルプとツールチップの追加
    - _Requirements: 7.3, 7.4_